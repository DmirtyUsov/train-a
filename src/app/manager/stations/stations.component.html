<form [formGroup]="newStationForm" (ngSubmit)="addStation()" novalidate>
  <div class="field">
    <label for="city" class="block">City</label>
    <input id="city" type="text" pInputText formControlName="city" />
    @if (
      newStationForm.get("city")?.invalid && newStationForm.get("city")?.dirty
    ) {
      <small class="p-error block"> City name is required</small>
    }
  </div>
  <div class="field">
    <label for="lastName" class="block">Last Name</label>
    <input
      type="text"
      pInputText
      placeholder="Last Name"
      formControlName="lastName"
    />
  </div>

  <div formGroupName="address">
    <h2>Address</h2>
    <div class="field">
      <label for="street" class="block">Street</label>
      <input
        type="text"
        pInputText
        placeholder="Street"
        formControlName="street"
      />
    </div>
    <div class="field">
      <label for="postCode" class="block">PostCode</label>
      <input
        type="text"
        pInputText
        placeholder="PostCode"
        formControlName="postCode"
      />
      <small
        class="p-error block"
        *ngIf="
          newStationForm.get('address')?.get('postCode')?.invalid &&
          newStationForm.get('address')?.get('postCode')?.dirty
        "
      >
        PostCode is required</small
      >
    </div>
  </div>

  <button pButton type="submit" [disabled]="newStationForm.invalid">
    Submit
  </button>
</form>

@if (isLoading$ | async) {
  <div class="flex justify-center">
    <p-progressSpinner ariaLabel="loading" />
  </div>
}

@if ((isLoading$ | async) === false) {
  <p-table
    [value]="(stationList$ | async)!"
    [tableStyle]="{ 'min-width': '25rem' }"
    styleClass="p-datatable-striped p-datatable-sm"
    class="text-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>id</th>
        <th>City</th>
        <th>latitude</th>
        <th>longitude</th>
        <th>connectedTo (km)</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-station>
      <tr class="text-sm">
        <td>{{ station.id }}</td>
        <td>
          <span class="text-lg bg-white border border-black rounded px-1">{{
            station.city
          }}</span>
        </td>
        <td>{{ station.latitude }}</td>
        <td>{{ station.longitude }}</td>
        <td class="flex flex-wrap gap-1">
          @for (item of station.connectedTo; track $index) {
            <div class="flex flex-col items-center">
              <span class="bg-white border border-black rounded px-1">{{
                stationsObject[item.id].city
              }}</span>
              <span class="text-xs">{{ item.distance | number: "1.0-0" }}</span>
            </div>
          }
        </td>
        <td>
          <p-confirmPopup [key]="'popupConfirmDelete-' + station.id" />
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="warning"
            (click)="confirmDelete($event, station.id)"
            title="Delete Station"
          />
        </td>
      </tr>
    </ng-template>
  </p-table>
}
